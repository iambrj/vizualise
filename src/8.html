<!DOCTYPE html>
<meta charset="utf-8">

<script src="https://d3js.org/d3.v4.js"></script>

<script>

const csvUrl =
"https://gist.githubusercontent.com/iambrj/e41d117877cbfd6c9f71286c7790a21e/raw/35e78e3916341bf3468e8293a39a171c86b4f99e/students.csv";
const famsizeColumn = "famsize";
const famrelColumn = "famrel";

d3.csv(csvUrl, function(data) {
    const famrelValues = [...new Set((data.map(datum => datum[famrelColumn]).sort()))];
    const famsizeValues = [...new Set((data.map(datum => datum[famsizeColumn]).sort()))];

    // Nested map for famrel, famsize vs alcohol consumption
    // Access pattern nmap[famrel][famsize] = list of students
    const nmap = new Map(famrelValues.map(famrelValue => {
        return [famrelValue, new Map(famsizeValues.map(famsizeValue => {
            return [famsizeValue, data.filter(datum => {
                return datum[famsizeColumn] == famsizeValue
                    && datum[famrelColumn] == famrelValue;
            })];
        }))];
    }));

    console.log(nmap);
});

</script>